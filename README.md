# Парсер дивидендной истории российских акций

Набор скриптов для получения дивидендной истории российских компаний с сайта https://закрытияреестров.рф/

## Структура проекта

```
├── data/                  # Папка с CSV-файлами дивидендной истории
├── metadata/             # Папка с служебными JSON-файлами
│   ├── ticker_mappings.json    # Соответствие тикеров и URL
│   └── parsing_summary.json    # Статистика парсинга
├── ticker_mapper.py      # Скрипт получения списка тикеров
├── dividend_parser.py    # Скрипт парсинга дивидендной истории
└── parse_all_dividends.py # Скрипт для обработки всех тикеров
```

## Описание скриптов

### ticker_mapper.py
Получает список всех доступных тикеров с главной страницы сайта.

Использование:
```bash
python ticker_mapper.py
```
Результат:
- Создает файл `metadata/ticker_mappings.json` со списком тикеров и соответствующих им URL

### dividend_parser.py
Парсит дивидендную историю для конкретного тикера.

Использование:
```bash
python dividend_parser.py
```
По умолчанию парсит LKOH (ЛУКОЙЛ). Для другого тикера нужно изменить значение в коде.

Результат:
- Создает CSV-файл в папке `data` с именем `ТИКЕР.csv`
- CSV содержит колонки:
  - closing_date: Дата закрытия реестра
  - year: Год, за который выплачивается дивиденд
  - period_type: Тип периода (full year - полный год, "X months" - X месяцев)
  - dividend_value: Размер дивиденда в рублях

### parse_all_dividends.py
Парсит дивидендную историю для всех доступных тикеров.

Использование:
```bash
python parse_all_dividends.py
```
Результат:
- Создает CSV-файлы для каждого тикера в папке `data`
- Создает файл `metadata/parsing_summary.json` со статистикой:
  - total_tickers: Общее количество тикеров
  - success_count: Количество успешно обработанных тикеров
  - failed_count: Количество тикеров с ошибками
  - success_rate: Процент успешных обработок
  - failed_tickers: Список тикеров с ошибками

## Порядок использования

1. Сначала получаем список тикеров:
```bash
python ticker_mapper.py
```

2. Затем запускаем парсинг всех тикеров:
```bash
python parse_all_dividends.py
```

## Зависимости

```
requests
beautifulsoup4
pandas
```

Установка зависимостей:
```bash
pip install requests beautifulsoup4 pandas
```

## Примечания

- Между запросами добавлена задержка в 1 секунду для избежания перегрузки сервера
- Все даты сохраняются в формате YYYY-MM-DD
- Размер дивиденда указывается в рублях
- При повторном запуске файлы перезаписываются 