# Парсер дивидендной истории российских акций

Скрипты для получения истории дивидендных выплат с сайта https://закрытияреестров.рф/

## Описание проекта

Проект предназначен для автоматического сбора данных о дивидендных выплатах российских компаний. Скрипты парсят веб-страницы и извлекают информацию о:
- Датах закрытия реестра
- Годах выплаты дивидендов
- Типах периодов (полный год, полугодие, 9 месяцев и т.д.)
- Размерах дивидендов в рублях
- Поддержке как обыкновенных, так и привилегированных акций

## Структура проекта

```
dividends/
├── data/                    # CSV файлы с данными о дивидендах
│   ├── SNGS.csv           # Обыкновенные акции Сургутнефтегаз
│   ├── SNGSP.csv          # Привилегированные акции Сургутнефтегаз
│   ├── PLZL.csv           # Обыкновенные акции Полюс
│   └── ...
├── metadata/               # JSON файлы с метаданными
│   ├── ticker_mappings.json    # Соответствие тикеров и URL
│   └── parsing_summary.json    # Результаты парсинга
├── ticker_mapper.py        # Получение списка доступных тикеров
├── dividend_parser.py      # Парсинг дивидендной истории
├── parse_all_dividends.py  # Парсинг всех тикеров
└── README.md               # Документация
```

## Скрипты

### 1. ticker_mapper.py
Получает список доступных тикеров с главной страницы сайта и сохраняет их в `metadata/ticker_mappings.json`.

**Функциональность:**
- Парсит главную страницу сайта
- Создает JSON-файл с соответствием тикеров акций и их URL на сайте
- Результат сохраняется в файл `metadata/ticker_mappings.json`

### 2. dividend_parser.py
Парсит дивидендную историю для конкретного тикера и сохраняет результаты в CSV файлы.

**Функциональность:**
- Автоматически определяет структуру таблицы (2 или 3 колонки)
- Обрабатывает как обыкновенные, так и привилегированные акции
- Создает отдельные CSV файлы для каждого типа акций
- Поддерживает различные периоды выплат (полный год, полугодие, 9 месяцев и т.д.)
- Корректно обрабатывает российский формат чисел (пробелы как разделители тысяч, запятые как десятичные разделители)

**Формат выходных файлов:**
- **Обыкновенные акции**: `TICKER.csv` (например, `SNGS.csv`)
- **Привилегированные акции**: `TICKERP.csv` (например, `SNGSP.csv`)

**Структура CSV файлов:**
```csv
closing_date,year,period_type,dividend_value
2025-07-17,2024,full year,0.90
2024-07-18,2023,full year,0.85
2023-07-20,2022,full year,0.80
```

### 3. parse_all_dividends.py
Парсит дивидендную историю для всех доступных тикеров.

**Функциональность:**
- Загружает список тикеров из `metadata/ticker_mappings.json`
- Обрабатывает каждый тикер с задержкой 2 секунды между запросами
- Создает отдельные CSV файлы для каждого тикера
- Генерирует JSON-файл с итоговой статистикой парсинга
- Автоматически создает отдельные файлы для обыкновенных и привилегированных акций

## Использование

### 1. Первоначальная настройка
```bash
python ticker_mapper.py
```
Это создаст файл `metadata/ticker_mappings.json` со списком доступных тикеров.

### 2. Парсинг конкретного тикера
```bash
python dividend_parser.py SNGS
```
Это создаст файлы:
- `data/SNGS.csv` - дивиденды по обыкновенным акциям
- `data/SNGSP.csv` - дивиденды по привилегированным акциям

### 3. Парсинг всех тикеров
```bash
python parse_all_dividends.py
```
Это обработает все доступные тикеры и создаст соответствующие CSV файлы.

## Зависимости

```bash
pip install requests beautifulsoup4 pandas
```

## Особенности работы

- **Задержка между запросами**: 2 секунды для избежания перегрузки сервера
- **Поддержка различных таблиц**: Автоматическое определение структуры таблицы (2 или 3 колонки)
- **Обработка периодов**: Поддержка полного года, полугодия, 9 месяцев и других периодов
- **Формат чисел**: Корректная обработка российского формата чисел с пробелами и запятыми
- **Двойные акции**: Автоматическое создание отдельных файлов для обыкновенных и привилегированных акций
- **Обработка ошибок**: Пропуск строк с некорректными данными и логирование ошибок

## Результаты

После выполнения скриптов в папке `data/` будут созданы CSV файлы с дивидендной историей, а в папке `metadata/` - файлы с метаданными и статистикой парсинга. 